<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Maintenance Date</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link th:href="@{/css/header-style.css}" rel="stylesheet">
</head>
<body>
<div class="container-fluid">
    <div class="header-h1"><h1>New Hardware's Maintenance Date</h1></div>

    <form th:object="${date}"
          style="max-width: 500px; margin: 0 auto">
        <div class="border border-secondary rounded p-3">
            <div class="form-group row mb-2">
                <label class="col-sm-4 col-form-label">Date</label>
                <div class="col-sm-8">
                    <label>
                        <input type="date" th:field="*{date}" class="form-control" required minlength="2"
                               maxlength="72" id="date"/>
                    </label>
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-sm-4 col-form-label">Description</label>
                <div class="col-sm-8">
                    <label>
                        <input type="text" th:field="*{description}" class="form-control" required minlength="2"
                               maxlength="72" id="description"/>
                    </label>
                </div>
            </div>

            <div class="text-center">
                <div class="btn-group" role="group">
                    <button th:onclick="save()"
                            type="button" class="btn btn-outline-success">Save
                    </button>
                    <a type="button" class="btn btn-outline-primary"
                       th:href="@{'/hardware/maintenanceDates/' + ${date.hardware.uuid}}">Back
                    </a>
                </div>
            </div>
        </div>

    </form>
</div>
<script th:inline="javascript">
    let date = document.getElementById('date');
    let description = document.getElementById('description');

    function save() {
        let body = {
            uuid: [[${date.uuid}]],
            date: date.value,
            hardware: [[${date.hardware}]],
            description: description.value
        }
        let url = '/hardware/maintenanceDates/';
        let method;

        if (window.location.href.includes("/add")) {
            method = 'POST';
            url += [[${date.hardware.uuid}]];
        } else {
            method = 'PUT';
            url += [[${date.uuid}]];
        }

        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: JSON.stringify(body)
        })
            .then(() => {
                if (method === 'POST') {
                    window.location.assign(url);
                } else {
                    window.location.reload();
                }
            });
    }
</script>

</body>
</html>